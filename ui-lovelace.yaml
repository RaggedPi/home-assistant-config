################################################################
## Ragged Jack Farm                                           ##
## Package: Lovelace UI                                       ##
## Author: David Durost <david.durost@gmail.com>              ##
## Url: http://ragedjackfarm.net                              ##
################################################################
resources:
  - type: js
    url: /community_plugin/tracking-number-card/tracking-number-card.js
  - type: module
    url: /community_plugin/power-wheel-card/power-wheel-card.js
  - type: module
    url: /community_plugin/group-card/group-card.js
  - type: js
    url: /community_plugin/vertical-stack-in-card/vertical-stack-in-card.js
  - type: module
    url: /community_plugin/weather-card/weather-card.js
  - type: module
    url: /community_plugin/dual-gauge-card/dual-gauge-card.js
  - type: module
    url: /community_plugin/lovelace-multiple-entity-row/multiple-entity-row.js?v=3.0.0
  - type: module
    url: /community_plugin/sun-card/sun-card.js
  - type: module
    url: /local/lovelace-animated-background/dist/lovelace-animated-background.js

animated_background:
  default_url: /local/background-animations/sunny.html
  entity: "sensor.storm_center"
  state_url:
      'sunny': /local/background-animations/sunny.html
      'partlycloudy': /local/background-animations/cloudy.html
      'cloudy': /local/background-animations/cloudy.html
      'mostlycloudy': /local/background-animations/mostlycloudy.html
      'clear-night': /local/background-animations/night.html
      'fog': /local/background-animations/fog.html

title: Ragged Jack Mtn
views:
  ################################################################
  ## Home View ###################################################
  ################################################################
  - title: Home
    icon: 'mdi:castle'
    path: default_view
    badges: []
    cards:
      - type: entities
        entities:
          ################
          # Power Status #
          ################
          - type: 'custom:dual-gauge-card'
            title: System Power
            inner:
              colors:
                - color: var(--label-badge-red)
                  value: 43
                - color: var(--label-badge-blue)
                  value: 48
                - color: var(--label-badge-yellow)
                  value: 47.3
                - color: var(--label-badge-blue)
                  value: 0
              entity: sensor.magnum_bmk_vdc
              label: Volts
              max: 62.5
              min: 40
              unit: V
            outer:
              colors:
                - color: var(--label-badge-red)
                  value: 80
                - color: var(--label-badge-green)
                  value: 94
                - color: var(--label-badge-yellow)
                  value: 90
                - color: var(--label-badge-blue)
                  value: 0
              entity: sensor.magnum_bmk_soc
              label: SOC
              max: 100
              min: 70
              unit: '%'
            footer:
              type: buttons
              entites:
                - switch.magnum_eq_toggle

          - type: section
          #################
          # System Status #
          #################
          - entity: sensor.magnum_inverter_aacout
            type: custom:multiple-entity-row
            name: System Status
            state_header: Amps Out
            secondary_info: last-changed
            entities:
              - entity: sensor.magnum_inverter_mode
                name: Charging Stage
              - entity: sensor.magnum_fault
              - entity: sensor.magnum_inverter_vacout
                name: VAC Out

          - type: section
          ###################
          # Device Tracking #
          ###################
          - entity: person.nova
            type: custom:multiple-entity-row
            name: People
            state_header: Nova
            secondary_info: last-changed
            entities:
              - entity: person.david
                name: David
              - entity: person.cat
                name: Catherine
              - entity: person.haven
                name: Haven
          
          # - type: entity-filter
          #   entities:
          #     - person.david
          #     - person.cat
          #   state_filter:
          #     - 'home'
          #   card:
          #     type: glance
          #     title: People at Home
              
          # - type: entity-filter
          #   entities:
          #     - person.david
          #     - person.cat
          #   state_filter:
          #     - 'work'
          #   card:
          #     type: glance
          #     title: People at Work              

          # - type: entity-filter
          #   entities:
          #     - person.david
          #     - person.cat
          #   state_filter:
          #     - 'not_home'
          #   card:
          #     type: glance
          #     title: People enjoying the life

      ###########
      # Weather #
      ###########
      - type: vertical-stack
        cards:      
          ####################
          # Weather Forecast #
          ####################
          - type: weather-forecast
            entity: weather.home
          ################
          # Storm Center #
          ################

          ###############
          # Storm Alert #
          ###############
          # - type: conditional
          #   conditions:
          #     - entity: sensor.storm_center_alerts
          #       state_not: 0
          #   card:
          #     type: glance
          #     title: Storm Alert
          #     entities:
          #       - sensor.storm_center_alerts

          #####################
          # Storm Information #
          #####################
          - entity: sensor.storm_center_wind_bearing
            type: custom:multiple-entity-row
            name: Storm Information
            state_header: Wind Bearing
            secondary_info: last-changed
            entities:
              - entity: sensor.storm_center_nearest_storm_distance
                name: Nearest Storm
              - entity: sensor.storm_center_nearest_storm_bearing
                name: Storm Bearing
              - entity: sensor.storm_center_wind_speed
                name: Wind Speed
          ################
          # Temperatures #
          ################
          - entity: sensor.storm_center_temperature
            type: custom:multiple-entity-row
            name: Temperatures
            state_header: Current Temperature
            secondary_info: last-changed
            entities:
              - entity: sensor.storm_center_apparent_temperature
                name: 'Feels Like'
          #################
          # Precipitation #
          #################
          - entity: binary_sensor.storm_center_is_precipitating
            type: custom:multiple-entity-row
            name: Precipitation
            state_header: Precipitation
            secondary_info: last-changed
            entities:
              - entity: sensor.storm_center_precip
                name: Type
              - entity: sensor.storm_center_intensity_of_precip
                name: Intensity
              - entity: sensor.storm_center_total_precip
                name: Total

          #################  
          # Weather radar #
          #################
          - type: picture-entity
            entity: camera.gyx

      ###############################
      # International Space Station #
      ###############################
      # - type: picture-entity
      #   entity: camera.iss

  ################################################################
  ## Power Center View ###########################################
  ################################################################
  - title: Power Center
    icon: 'mdi:power-socket-us'
    path: inverter_stats
    badges: []
    cards:
      ###############
      # Power Gauge #
      ###############
      - type: entities
        entities:
          ################
          # Power Status #
          ################
          - type: 'custom:dual-gauge-card'
            title: System Power
            inner:
              colors:
                - color: var(--label-badge-red)
                  value: 43
                - color: var(--label-badge-blue)
                  value: 48
                - color: var(--label-badge-yellow)
                  value: 47.3
                - color: var(--label-badge-blue)
                  value: 0
              entity: sensor.magnum_bmk_vdc
              label: Volts
              max: 62.5
              min: 40
              unit: V
            outer:
              colors:
                - color: var(--label-badge-red)
                  value: 80
                - color: var(--label-badge-green)
                  value: 94
                - color: var(--label-badge-yellow)
                  value: 90
                - color: var(--label-badge-blue)
                  value: 0
              entity: sensor.magnum_bmk_soc
              label: SOC
              max: 100
              min: 70
              unit: '%'

          - type: section
          #################
          # System Status #
          #################
          - entity: sensor.magnum_inverter_mode
            type: custom:multiple-entity-row
            name: System Status
            state_header: 'Mode'
            secondary_info: last-changed
            entities:
              - entity: sensor.magnum_inverter_aacout
                name: 'Amps Out'
              - entity: sensor.magnum_inverter_vacout
                name: 'VAC Out'
              - entity: sensor.magnum_fault
      ################
      # Power States #
      ################
      - type: entities
        title: Power
        show_header_toggle: false
        entities:
          ############
          # AC Power #
          ############
          - entity: sensor.magnum_inverter_vacout
            type: custom:multiple-entity-row
            name: AC
            state_header: VAC Out
            secondary_info: last-changed
            entities:
              - entity: sensor.magnum_inverter_aacin
                name: Amps In
              - entity: sensor.magnum_inverter_aacout
                name: Amps out
              - entity: sensor.magnum_inverter_vacin
                name: VAC In

          - type: section
          ############
          # DC Power #
          ############
          - entity: sensor.magnum_bmk_adc
            type: custom:multiple-entity-row
            name: DC
            state_header: VDC Out
            secondary_info: last-changed
            entities:
              - entity: sensor.magnum_bmk_vmin
              - entity: sensor.magnum_bmk_vmax
              - entity: sensor.magnum_bmk_vdc
                name: Current Voltage
      - type: entities
        title: Stats
        show_header_toggle: false
        entities:
          ################
          # Temperatures #
          ################
          - entity: sensor.magnum_inverter_tfmr
            type: custom:multiple-entity-row
            name: Temperatures
            secondary_info: last-changed
            state_header: Transformer
            entities: 
              - entity: sensor.magnum_inverter_bat
                name: Battery
              - entity: sensor.magnum_inverter_fet
                name: FET

          - type: section
          ######################
          # Firmware Revisions #
          ######################
          - entity: sensor.magnum_remote_revision
            type: custom:multiple-entity-row
            name: Revisions
            secondary_info: Firmware
            state_header: Remote
            entities:
              - entity: sensor.magnum_inverter_revision
                name: Inverter
              - entity: sensor.magnum_bmk_revision
                name: BMK
              - entity: sensor.magnum_ags_revision
                name: AGS

          - type: section
          ################
          # Misc Sensors #
          ################
          - entity: sensor.magnum_bmk_amph
            type: custom:multiple-entity-row
            name: 'Misc'
            state_header: AmpHours
            entities:
              - entity: sensor.magnum_inverter_model
                name: Inverter Model
              - entity: sensor.magnum_inverter_frequency

      #######
      # AGS #
      #######
      - type: entities
        title: AGS
        show_header_toggle: false
        entities:
          - entity: switch.magnum_ags_manual
            type: custom:multiple-entity-row
            name: Generac
            secondary_info: last-changed
            state_header: Run
            toggle: true
            entities:
              - entity: binary_sensor.magnum_ags_running
                name: Generator running
              - entity: sensor.magnum_ags_runtime 
                name: Runtime      
              - entity: sensor.magnum_ags_status_text
                name: Status
  
  ################################################################
  ## PV System View ##############################################
  ################################################################
  - title: PV System
    icon: 'mdi:solar-power'
    path: solar
    badges: []
    cards:
      ##############################
      # Weather Conditions Section #
      ##############################
      - type: entities
        entities:
        #######
        # Sun #
        #######
        - type: "custom:sun-card"
          name: ''

        - type: section
        ######################
        # Today's Conditions #
        ######################
        - type: custom:multiple-entity-row
          entity: sensor.pv_cloud_coverage_0d
          name: Today
          state_header: Cloud Coverage
          secondary_info: last-changed
          entities:
            - entity: sensor.pv_visibility_0d
              name: Visibility

        - type: section
        #########################
        # Tomorrow's Conditions #
        #########################
        - type: custom:multiple-entity-row
          entity: sensor.pv_cloud_coverage_1d
          name: Tomorrow
          state_header: Cloud Coverage
          secondary_info: last-changed
          entities:
            - entity: sensor.pv_visibility_1d
              name: Visibility

      #####################
      # PV Status Section #
      #####################
      - type: entities
        entities:
        ############
        # PV Gauge #
        ############
        - type: custom:dual-gauge-card
          title: PV Power
          inner:
            colors:
              - color: var(--label-badge-red)
                value: 63
              - color: var(--label-badge-green)
                value: 48.1
              - color: var(--label-badge-yellow)
                value: 43
              - color: var(--label-badge-blue)
                value: 0
            entity: sensor.classic_pv_voltage
            label: PV 
            max: 120
            min: 10
            unit: V
          outer:
            colors:
              - color: var(--label-badge-red)
                value: 43
              - color: var(--label-badge-green)
                value: 48
              - color: var(--label-badge-yellow)
                value: 47.3
              - color: var(--label-badge-blue)
                value: 0
            entity: sensor.magnum_bmk_vdc # use classic battery reading in future
            label: Bat
            max: 62.5
            min: 40
            unit: V

        - type: section
        #############
        # Mode data #
        #############
        - type: custom:multiple-entity-row
          entity: sensor.classic_mode_time
          name: Charge Controller
          name_state: Time
          secondary_info: last-changed
          entities:
            - entity: sensor.classic_mode

      #########################
      # Classic Stats Section #
      #########################
      - type: entities
        title: System Statistics
        show_header_toggle: false
        entities:
        ############
        # PV Array #
        ############
        - type: custom:multiple-entity-row
          entity: sensor.classic_pv_power
          name: PV Array
          state_header: Power
          secondary_info: last-changed
          entities:
            - entity: sensor.classic_pv_current
              name: Current
            - entity: sensor.classic_pv_voltage
              name: Voltage
        
        - type: section
        ################
        # Temperatures #
        ################
        - type: custom:multiple-entity-row
          entity: sensor.classic_battery_temp_c
          name: Temperatures
          state_header: Battery
          secondary_info: last-changed
          entities:
            - entity: sensor.classic_fet_temp_c
              name: FET
            - entity: sensor.classic_pcb_temp_c
              name: PCB

        - type: section
        ################
        # Battery Bank #
        ################
        - type: custom:multiple-entity-row
          entity: sensor.classic_battery_capacity
          name: 'Battery Bank'
          state_header: Capacity
          secondary_info: last-changed
          entities:
            - entity: sensor.classic_battery_current
              name: Current
            - entity: sensor.classic_battery_voltage
              name: Voltage
            - entity: sensor.classic_nom_battery_voltage
              name: Nominal Voltage
        
        - type: section
        ############
        # Firmware #
        ############
        - type: custom:multiple-entity-row
          entity: sensor.classic_model
          name: Midnite Classic
          state_header: Model
          secondary_info: last-changed
          entities:
            - entity: sensor.classic_pcb
              name: Firmware Revision
            - entity: sensor.classic_revision_date
              name: Revision Date

  ################################################################
  ## Generator Management View ###################################
  ################################################################
  - title: Generator Management
    icon: 'fas:charging-station'
    path: generator_mgmt
    badges: []
    cards: 
      - type: entities
        title: Generator Status
        show_header_toggle: false
        entities:
        #############
        # Run Stats #
        #############
        - type: custom:multiple-entity-row
          entity: sensor.generac_status
          name: Generator Status
          state_header: 'Status'
          secondary_info: last-changed
          entities:
            - entity: sensor.generac_battery_voltage
              name: Battery Volts
            - entity: sensor.generac_rpm
              name: 'RPM'
            - entity: sensor.generac_frequency
              name: Frequency

        - type: section
        ###################
        # Generator Stats #
        ###################
        - type: custom:multiple-entity-row
          entity: sensor.generac_output_power
          name: Generator Energy
          secondary_info: last-changed
          state_header: 'Output Power'
          entities:
            - entity: sensor.generac_output_current
              name: Output Current
            - entity: sensor.generac_output_voltage
              name: Output Voltage

        - type: section
        ########################
        # Evolution Controller #
        ########################
        - type: custom:multiple-entity-row
          entity: sensor.generac_uptime
          name: Controller
          state_header: 'Uptime'
          secondary_info: last-changed
          entities:
            - entity: sensor.generac_cpu_temp
              name: 'CPU Temperature'
            - entity: sensor.generac_last_action
              name: 'Last Action'
            - entity: sensor.generac_exercise_time
              name: 'Exercise Time'
        
        - type: section
        ########
        # Logs #
        ########
        - type: custom:multiple-entity-row
          entity: sensor.generac_log_last_service
          name: 'Logs'
          secondary_info: last-changed
          state_header: 'Last Service'
          entities:
            - entity: sensor.generac_model
              name: 'Model'
            - entity: sensor.generac_log_last_alarm
              name: 'Last Alarm'

  ################################################################
  ## Media Control View ##########################################
  ################################################################ 
  - title: Media Control
    icon: 'mdi:remote'
    path: media-control
    badges: []
    cards:
      ###########
      # Roku TV #
      ###########
      - entity: media_player.roku_2n008r420534
        type: media-control
