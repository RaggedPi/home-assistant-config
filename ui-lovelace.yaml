################################################################
## Ragged Jack Farm                                           ##
## Package: Lovelace UI                                       ##
## Author: David Durost <david.durost@gmail.com>              ##
## Url: http://ragedjackfarm.net                              ##
################################################################
resources:
  - type: module
    url: /local/flex-horseshoe-card/flex-horseshoe-card.js
  - type: module
    url: /community_plugin/group-card/group-card.js
  - type: js
    url: /community_plugin/vertical-stack-in-card/vertical-stack-in-card.js
  - type: module
    url: /community_plugin/weather-card/weather-card.js
  - type: module
    url: /community_plugin/dual-gauge-card/dual-gauge-card.js
  - type: module
    url: /community_plugin/lovelace-multiple-entity-row/multiple-entity-row.js?v=3.0.0
  - type: module
    url: /community_plugin/sun-card/sun-card.js
  - type: module
    url: /local/lovelace-animated-background/dist/lovelace-animated-background.js
  - type: module
    url: /community_plugin/button-card/button-card.js
  - type: module
    url: /community_plugin/bar-card/bar-card.js
  - type: module
    url: /local/tracker-card/tracker-card.js?track=true

animated_background:
  default_url: /local/background-animations/sunny.html
  entity: "sensor.storm_center"
  state_url:
      'sunny': /local/background-animations/sunny.html
      'partlycloudy': /local/background-animations/cloudy.html
      'cloudy': /local/background-animations/cloudy.html
      'mostlycloudy': /local/background-animations/mostlycloudy.html
      'clear-night': /local/background-animations/night.html
      'fog': /local/background-animations/fog.html

title: Ragged Jack Mtn
views:
  ################################################################
  ## Home View ###################################################
  ################################################################
  - title: Home
    icon: 'mdi:castle'
    path: default_view
    badges: []
    cards:
      - type: entities
        entities:
          ################
          # Power Status #
          ################
          - type: 'custom:dual-gauge-card'
            title: System Power
            inner:
              colors:
                - color: var(--label-badge-red)
                  value: 43
                - color: var(--label-badge-blue)
                  value: 48
                - color: var(--label-badge-yellow)
                  value: 47.3
                - color: var(--label-badge-blue)
                  value: 0
              entity: sensor.magnum_bmk_vdc
              label: Volts
              max: 62.5
              min: 40
              unit: V
            outer:
              colors:
                - color: var(--label-badge-red)
                  value: 80
                - color: var(--label-badge-green)
                  value: 94
                - color: var(--label-badge-yellow)
                  value: 90
                - color: var(--label-badge-blue)
                  value: 0
              entity: sensor.magnum_bmk_soc
              label: SOC
              max: 100
              min: 70
              unit: '%'
            footer:
              type: buttons
              entites:
                - switch.magnum_eq_toggle

          - type: section
          #################
          # System Status #
          #################
          - entity: sensor.magnum_inverter_aacout
            type: custom:multiple-entity-row
            name: System Status
            state_header: Amps Out
            secondary_info: last-changed
            entities:
              - entity: sensor.magnum_inverter_mode
                name: Charging Stage
              - entity: sensor.magnum_fault
              - entity: sensor.magnum_inverter_vacout
                name: VAC Out
            footer:
              type: buttons
              entities:
                - entity: input_boolean.school_mode
                - entity: input_boolean.guest_mode
          - type: section
          ###################
          # Device Tracking #
          ###################
          - entity: person.nova
            type: custom:multiple-entity-row
            name: People
            state_header: Nova
            secondary_info: last-changed
            entities:
              - entity: person.david
                name: David
              - entity: person.cat
                name: Catherine
              - entity: person.haven
                name: Haven
          
          # - type: entity-filter
          #   entities:
          #     - person.david
          #     - person.cat
          #   state_filter:
          #     - 'home'
          #   card:
          #     type: glance
          #     title: People at Home
              
          # - type: entity-filter
          #   entities:
          #     - person.david
          #     - person.cat
          #   state_filter:
          #     - 'work'
          #   card:
          #     type: glance
          #     title: People at Work              

          # - type: entity-filter
          #   entities:
          #     - person.david
          #     - person.cat
          #   state_filter:
          #     - 'not_home'
          #   card:
          #     type: glance
          #     title: People enjoying the life

      ###########
      # Weather #
      ###########
      - type: vertical-stack
        cards:      
          ####################
          # Weather Forecast #
          ####################
          - type: weather-forecast
            entity: weather.home
          ################
          # Storm Center #
          ################

          ###############
          # Storm Alert #
          ###############
          # - type: conditional
          #   conditions:
          #     - entity: sensor.storm_center_alerts
          #       state_not: 0
          #   card:
          #     type: glance
          #     title: Storm Alert
          #     entities:
          #       - sensor.storm_center_alerts

          #####################
          # Storm Information #
          #####################
          - entity: sensor.storm_center_wind_bearing
            type: custom:multiple-entity-row
            name: Storm Information
            state_header: Wind Bearing
            secondary_info: last-changed
            entities:
              - entity: sensor.storm_center_nearest_storm_distance
                name: Nearest Storm
              - entity: sensor.storm_center_nearest_storm_bearing
                name: Storm Bearing
              - entity: sensor.storm_center_wind_speed
                name: Wind Speed
          ################
          # Temperatures #
          ################
          - entity: sensor.storm_center_temperature
            type: custom:multiple-entity-row
            name: Temperatures
            state_header: Current Temperature
            secondary_info: last-changed
            entities:
              - entity: sensor.storm_center_apparent_temperature
                name: 'Feels Like'
          #################
          # Precipitation #
          #################
          # Snow
          - type: conditional
            conditions:
              - entity: binary_sensor.storm_center_precip
                state: 'snow'
            card:
              entity: sensor.storm_center_precip
              type: custom:multiple-entity-row
              name: Precipitation
              state_header: Type
              secondary_info: last-changed
              entities:
                - entity: sensor.storm_center_precip_intensity
                  name: Intensity
                - entity: sensor.storm_center_precip_accumulation
                  name: Total
          # Rain/ Sleet
          - type: conditional
            conditions:
              - entity: sensor.storm_center_precip
                state_not: 'snow'
              - entity: sensor.storm_center_precip
                state_not: 'unknown'
            card:
              entity: sensor.storm_center_precip
              type: custom:multiple-entity-row
              name: Precipitation
              state_header: Type
              secondary_info: last-changed
              entities:
                - entity: sensor.storm_center_precip_intensity
                  name: Intensity
          #################  
          # Weather radar #
          #################
          - type: picture-entity
            entity: camera.gyx

      ###############################
      # International Space Station #
      ###############################
      # - type: picture-entity
      #   entity: camera.iss

  ################################################################
  ## Power Center View ###########################################
  ################################################################
  - title: Power Center
    icon: 'mdi:power-socket-us'
    path: inverter_stats
    badges: []
    cards:
      ###############
      # Power Gauge #
      ###############
      - type: entities
        entities:
          ################
          # Power Status #
          ################
          - type: 'custom:dual-gauge-card'
            title: System Power
            inner:
              colors:
                - color: var(--label-badge-red)
                  value: 43
                - color: var(--label-badge-blue)
                  value: 48
                - color: var(--label-badge-yellow)
                  value: 47.3
                - color: var(--label-badge-blue)
                  value: 0
              entity: sensor.magnum_bmk_vdc
              label: Volts
              max: 62.5
              min: 40
              unit: V
            outer:
              colors:
                - color: var(--label-badge-red)
                  value: 80
                - color: var(--label-badge-green)
                  value: 94
                - color: var(--label-badge-yellow)
                  value: 90
                - color: var(--label-badge-blue)
                  value: 0
              entity: sensor.magnum_bmk_soc
              label: SOC
              max: 100
              min: 70
              unit: '%'

          - type: section
          #################
          # System Status #
          #################
          - entity: sensor.magnum_inverter_mode
            type: custom:multiple-entity-row
            name: System Status
            state_header: 'Mode'
            secondary_info: last-changed
            entities:
              - entity: sensor.magnum_inverter_aacout
                name: 'Amps Out'
              - entity: sensor.magnum_inverter_vacout
                name: 'VAC Out'
              - entity: sensor.magnum_fault
      - type: horizontal-stack
        cards:
          - type: "custom:button-card"
            name: EQ
            entity: switch.magnum_eq_toggle
            color: rgb(28, 128, 199)
          - type: "custom:button-card"
            name: Charger
            entity: switch.magnum_chg_toggle
            color: rgb(28, 128, 199)
          - type: "custom:button-card"
            name: Inverter
            entity: switch.magnum_inverter_toggle
            color: rgb(28, 128, 199)
          - type: "custom:button-card"
            name: AGS
            entity: switch.magnum_ags_manual
            color: rgb(28, 128, 199)
          
      ################
      # Power States #
      ################
      - type: entities
        title: Power
        show_header_toggle: false
        entities:
          ############
          # AC Power #
          ############
          - entity: sensor.magnum_inverter_vacout
            type: custom:multiple-entity-row
            name: AC
            state_header: VAC Out
            secondary_info: last-changed
            entities:
              - entity: sensor.magnum_inverter_aacin
                name: Amps In
              - entity: sensor.magnum_inverter_aacout
                name: Amps out
              - entity: sensor.magnum_inverter_vacin
                name: VAC In

          - type: section
          ############
          # DC Power #
          ############
          - entity: sensor.magnum_bmk_adc
            type: custom:multiple-entity-row
            name: DC
            state_header: VDC Out
            secondary_info: last-changed
            entities:
              - entity: sensor.magnum_bmk_vmin
              - entity: sensor.magnum_bmk_vmax
              - entity: sensor.magnum_bmk_vdc
                name: Current Voltage
      - type: entities
        title: Stats
        show_header_toggle: false
        entities:
          ################
          # Temperatures #
          ################
          - entity: sensor.magnum_inverter_tfmr
            type: custom:multiple-entity-row
            name: Temperatures
            secondary_info: last-changed
            state_header: Transformer
            entities: 
              - entity: sensor.magnum_inverter_bat
                name: Battery
              - entity: sensor.magnum_inverter_fet
                name: FET

          - type: section
          ######################
          # Firmware Revisions #
          ######################
          - entity: sensor.magnum_remote_revision
            type: custom:multiple-entity-row
            name: Revisions
            secondary_info: Firmware
            state_header: Remote
            entities:
              - entity: sensor.magnum_inverter_model
                name: Inverter Model
              - entity: sensor.magnum_inverter_revision
                name: Inverter
              - entity: sensor.magnum_bmk_revision
                name: BMK
              - entity: sensor.magnum_ags_revision
                name: AGS

          - type: section
          ################
          # Misc Sensors #
          ################
          - entity: sensor.magnum_bmk_amph
            type: custom:multiple-entity-row
            name: 'Misc'
            state_header: AmpHours
            entities:
              - entity: sensor.magnum_inverter_frequency

      #######
      # AGS #
      #######
      - type: entities
        title: AGS
        show_header_toggle: false
        entities:
          - entity: switch.magnum_ags_manual
            type: custom:multiple-entity-row
            name: Generac
            secondary_info: last-changed
            state_header: Run
            toggle: true
            entities:
              - entity: binary_sensor.magnum_ags_running
                name: Generator running
              - entity: sensor.magnum_ags_runtime 
                name: Runtime      
              - entity: sensor.magnum_ags_status_text
                name: Status
  
  ################################################################
  ## PV System View ##############################################
  ################################################################
  - title: PV System
    icon: 'mdi:solar-power'
    path: solar
    badges: []
    cards:
      ##############################
      # Weather Conditions Section #
      ##############################
      - type: entities
        entities:
        #######
        # Sun #
        #######
        - type: "custom:sun-card"
          name: ''

        - type: section
        ######################
        # Today's Conditions #
        ######################
        - type: custom:multiple-entity-row
          entity: sensor.pv_cloud_coverage_0d
          name: Today
          state_header: Cloud Coverage
          secondary_info: last-changed
          entities:
            - entity: sensor.pv_visibility_0d
              name: Visibility

        - type: section
        #########################
        # Tomorrow's Conditions #
        #########################
        - type: custom:multiple-entity-row
          entity: sensor.pv_cloud_coverage_1d
          name: Tomorrow
          state_header: Cloud Coverage
          secondary_info: last-changed
          entities:
            - entity: sensor.pv_visibility_1d
              name: Visibility

      #####################
      # PV Status Section #
      #####################
      - type: entities
        entities:
        ############
        # PV Gauge #
        ############
        - type: 'custom:flex-horseshoe-card'
          entities:
            - entity: sensor.classic_pv_voltage
              decimals: 1
              unit: 'V'
              name: PV Input
            - entity: sensor.classic_power
              decimals: 1
              unit: 'W'
            - entity: sensor.classic_pv_current
              decimals: 1
              unit: 'A'
          show:
            horseshoe_style: 'lineargradient'
          layout:
            hlines:
              - id: 0
                xpos: 50
                ypos: 48
                length: 40
                styles:
                  - stroke: var(--primary-text-color);
                  - stroke-width: 2;
                  - opacity: 0.5;
              - id: 1
                xpos: 50
                ypos: 20
                length: 40
                styles:
                  - stroke: var(--primary-text-color);
                  - stroke-width: 2;
                  - opacity: 0.5;
            circles:
              - xpos: 50
                ypos: 61
                radius: 5
                styles:
                  - fill: var(--primary-text-color);
                  - opacity: 0.5;
            states:
              - id: 0
                entity_index: 0
                xpos: 50
                ypos: 40
                styles:
                  - font-size: 3em;
              - id: 1
                entity_index: 1
                xpos: 46
                ypos: 64
                styles:
                  - text-anchor: end;
                  - font-size: 1.6em;
              - id: 2
                entity_index: 2
                xpos: 54
                ypos: 64
                styles:
                  - text-anchor: start;
                  - font-size: 1.6em;
            names:
              - id: 0
                entity_index: 0
                xpos: 50
                ypos: 80
            
          horseshoe_scale:
            min: 15
            max: 110
            ticksize: 1
          color_stops:
            16: '#FFF6E3'
            17: '#FFE9B9'
            18: '#FFDA8A'
            19: '#FFCB5B'
            20: '#FFBF37'
            21: '#ffb414'
            22: '#FFAD12'
            23: '#FFA40E'
            24: '#FF9C0B' 
            25: '#FF8C06' 

        - type: section
        #############
        # Mode data #
        #############
        - type: 'custom:multiple-entity-row'
          entity: sensor.classic_mode
          name: Charge Controller
          name_state: Time
          secondary_info: last-changed
          entities:
            - entity: sensor.classic_rest_reason_text

      #########################
      # Classic Stats Section #
      #########################
      - type: entities
        title: System Statistics
        show_header_toggle: false
        entities:
        ############
        # PV Array #
        ############
        - type: custom:multiple-entity-row
          entity: sensor.classic_power
          name: PV Array
          state_header: Power
          secondary_info: last-changed
          entities:
            - entity: sensor.classic_pv_current
              name: Current
            - entity: sensor.classic_pv_voltage
              name: Voltage
        
        - type: section
        ################
        # Temperatures #
        ################
        - type: custom:multiple-entity-row
          entity: sensor.classic_battery_temp
          name: Temperatures
          state_header: Battery
          secondary_info: last-changed
          entities:
            - entity: sensor.classic_fet_temp
              name: FET
            - entity: sensor.classic_pcb_temp
              name: PCB

        - type: section
        ################
        # Battery Bank #
        ################
        - type: custom:multiple-entity-row
          entity: sensor.classic_battery_current
          name: 'Battery Bank'
          state_header: Current
          secondary_info: last-changed
          entities:
            - entity: sensor.classic_total_ah_daily
              name: Amp Hours
            - entity: sensor.classic_battery_voltage
              name: Voltage
            - entity: sensor.classic_nom_battery_voltage
              name: Nominal Voltage
        
        - type: section
        ############
        # Firmware #
        ############
        - type: custom:multiple-entity-row
          entity: sensor.classic_model
          name: Classic
          state_header: Model
          secondary_info: last-changed
          entities:
            - entity: sensor.classic_appversion
              name: Firmware Revision
            - entity: sensor.classic_build_date
              name: Revision Date

  ################################################################
  ## Generator Management View ###################################
  ################################################################
  - title: Generator Management
    icon: 'fas:charging-station'
    path: generator_mgmt
    badges: []
    cards: 
      - type: entities
        title: Generator Status
        show_header_toggle: false
        entities:
        #############
        # Run Stats #
        #############
        - type: custom:multiple-entity-row
          entity: sensor.generac_status
          name: Generator Status
          state_header: 'Status'
          secondary_info: last-changed
          entities:
            - entity: sensor.generac_battery_voltage
              name: Battery Volts
            - entity: sensor.generac_rpm
              name: 'RPM'
            - entity: sensor.generac_frequency
              name: Frequency

        - type: section
        ###################
        # Generator Stats #
        ###################
        - type: custom:multiple-entity-row
          entity: sensor.generac_output_power
          name: Generator Energy
          secondary_info: last-changed
          state_header: 'Output Power'
          entities:
            - entity: sensor.generac_output_current
              name: Output Current
            - entity: sensor.generac_output_voltage
              name: Output Voltage

        - type: section
        ########################
        # Evolution Controller #
        ########################
        - type: custom:multiple-entity-row
          entity: sensor.generac_uptime
          name: Controller
          state_header: 'Uptime'
          secondary_info: last-changed
          entities:
            - entity: sensor.generac_cpu_temp
              name: 'CPU Temperature'
            - entity: sensor.generac_last_action
              name: 'Last Action'
            - entity: sensor.generac_exercise_time
              name: 'Exercise Time'
        
        - type: section
        ########
        # Logs #
        ########
        - type: custom:multiple-entity-row
          entity: sensor.generac_log_last_service
          name: 'Logs'
          secondary_info: last-changed
          state_header: 'Last Service'
          entities:
            - entity: sensor.generac_model
              name: 'Model'
            - entity: sensor.generac_log_last_alarm
              name: 'Last Alarm'

  ################################################################
  ## Media Control View ##########################################
  ################################################################ 
  - title: Media Control
    icon: 'mdi:remote'
    path: media-control
    badges: []
    cards:
      ###########
      # Roku TV #
      ###########
      - entity: media_player.roku_2n008r420534
        type: media-control
  ################################################################
  ## System Monitor View #########################################
  ################################################################
  - title: System Monitor
    icon: 'mdi:settings'
    path: sys-monitor
    badges: []
    cards:
      - type: vertical-stack
        cards:

          ##########
          # System #
          ##########
          - type: entities
            title: System
            show_header_toggle: false
            entities:
              - entity: sensor.installed_version
                name: Hassio Installed Version
                icon: mdi:home-assistant
              - entity: sensor.latest_available_version
                name: Hassio Current Version
                icon: mdi:home-assistant

              - type: divider

              - entity: sensor.last_boot_date_time
                icon: mdi:calendar
              - entity: sensor.rpi_uptime
                icon: mdi:clock-start
              - entity: sensor.ha_uptime
                icon: mdi:home-assistant

              - type: custom:bar-card
                title: Processor Use
                entity: sensor.processor_use
                height: 30px
                animation: 'off'
                indicator: 'off'
                severity:
                  - value: 60
                    color: green
                  - value: 85 
                    color: orange
                  - value: 100
                    color: red

              - type: custom:bar-card
                title: CPU Temp
                entity: sensor.cpu_temp
                animation: 'off'
                indicator: 'off'
                height: 30px
                severity:
                  - value: 60
                    color: green
                  - value: 70 
                    color: orange
                  - value: 100
                    color: red

              - type: custom:bar-card
                title: Memory Use
                entity: sensor.memory_use_percent
                height: 30px
                animation: 'off'
                indicator: 'off'
                severity:
                  - value: 60
                    color: green
                  - value: 85 
                    color: orange
                  - value: 100
                    color: red

              - type: custom:bar-card
                title: Disk Use
                entity: sensor.disk_use_percent
                height: 30px
                animation: 'off'
                indicator: 'off'
                severity:
                  - value: 60
                    color: green
                  - value: 85 
                    color: orange
                  - value: 100
                    color: red

              - type: divider

              - entity: sensor.public_ip_address
                icon: mdi:ip-network

      #======================================
      # Have I Been Pwned and Component Counts
      #======================================
      - type: vertical-stack
        cards:

          #=============================
          # Component Counts
          #=============================
          - type: glance
            title: Component Count
            columns: 4
            entities:
              - entity: sensor.count_automations
                name: Automations
                icon: mdi:autorenew
              - entity: sensor.count_scripts
                name: Scripts
                icon: mdi:script-text-outline
              - entity: sensor.count_zones
                name: Zones
                icon: mdi:map-marker-radius
              - entity: sensor.count_device_trackers
                name: Device Trackers
                icon: mdi:map-marker
              - entity: sensor.count_switches
                name: Switches
                icon: mdi:light-switch
              - entity: sensor.count_sensors
                name: Sensors
                icon: mdi:resistor
              - entity: sensor.count_binary_sensors
                name: Binary Sensors
                icon: mdi:unfold-more-horizontal
              - entity: sensor.count_input_booleans
                name: Input Booleans
                icon: mdi:toggle-switch
              - entity: sensor.count_input_numbers
                name: Input Numbers
                icon: mdi:numeric
              - entity: sensor.count_input_texts
                name: Input Texts
                icon: mdi:alphabetical
              - entity: sensor.count_input_selects
                name: Input Select
                icon: mdi:view-list
              - entity: sensor.count_input_datetimes
                name: Input Date Times
                icon: mdi:calendar-clock
          

          #=============================
          # Custom Component Updates
          #=============================
      - type: vertical-stack
        cards:

          - type: custom:tracker-card
            title:
            trackers:
              - sensor.custom_card_tracker
              - sensor.custom_component_tracker